---
https://tools.thinkinai.xyz/layout: post
title: "é˜¿é‡Œäº‘ 2æ ¸ 0.5GB å†…å­˜çš„è½»é‡æœåŠ¡å™¨ä¸Šï¼Œéƒ¨ç½² PHP 7.4 + Nginx çš„ç¡®è¦ç²¾æ‰“ç»†ç®—"
subtitle: "å†…å­˜å ç”¨æœ€å°,ä¾èµ–ç²¾ç®€,æœåŠ¡ç¨³å®šè¿è¡Œ,é€‚åˆå•ç«™ç‚¹æˆ–é™æ€/å°å‹ PHP åº”ç”¨"
date: 2025-06-20
author: "ai wu"
header-img: "https://archive.biliimg.com/bfs/archive/ced415ab3ac9ba35c050e32dffe15f8197db9ec8.png"
tags:
  - AIç¼–ç¨‹
  - ç¯å¢ƒé…ç½®
---

**é˜¿é‡Œäº‘ 2æ ¸ 0.5GB å†…å­˜** çš„è½»é‡æœåŠ¡å™¨ä¸Šï¼Œéƒ¨ç½² PHP 7.4 + Nginx çš„ç¡®è¦ç²¾æ‰“ç»†ç®—ã€‚æˆ‘ä»¬è¿½æ±‚çš„æ˜¯ï¼š



- **å†…å­˜å ç”¨æœ€å°**
- **ä¾èµ–ç²¾ç®€**
- **æœåŠ¡ç¨³å®šè¿è¡Œ**
- **é€‚åˆå•ç«™ç‚¹æˆ–é™æ€/å°å‹ PHP åº”ç”¨**

------





### **âœ… æ¨èç»„åˆ**



| **æœåŠ¡** | **æ¨èç‰ˆæœ¬**   | **è¯´æ˜**                               |
| -------- | -------------- | -------------------------------------- |
| PHP      | 7.4.x          | å®˜æ–¹å·²åœæ­¢ç»´æŠ¤ï¼Œä½†å…¼å®¹æ€§é«˜ã€å†…å­˜å ç”¨ä½ |
| Nginx    | 1.18+ (ç¨³å®šç‰ˆ) | ç¨³å®šå¯é ï¼Œå ç”¨å°                       |
| PHP-FPM  | PHP è‡ªå¸¦       | PHP FastCGI ç®¡ç†å™¨                     |
| OS       | Ubuntu 20.04   | ç³»ç»ŸåŒ…ç®¡ç†å¥½ï¼Œç¤¾åŒºæ´»è·ƒ                 |

> âš ï¸ **ä¸å»ºè®®ç”¨ Apache**ï¼Œå› ä¸ºå®ƒæ¯” Nginx æ›´åƒå†…å­˜ã€‚



------





### **ğŸ§± å®‰è£…ç¯å¢ƒå‡†å¤‡**



#### **1.** **ç³»ç»Ÿæœ€å°ä¼˜åŒ–ï¼ˆUbuntuï¼‰**



```
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget vim unzip net-tools software-properties-common
```



#### **2.** **å®‰è£… Nginx**



```
sudo apt install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx
```



#### **3.** **å®‰è£… PHP 7.4 + PHP-FPM**



##### **Ubuntu:**



```
sudo add-apt-repository ppa:ondrej/php
sudo apt update
sudo apt install -y php7.4 php7.4-fpm php7.4-cli php7.4-mbstring php7.4-xml php7.4-curl php7.4-mysql php7.4-zip
```





#### **4.**

#### **å¯åŠ¨ PHP-FPM**



```
sudo systemctl enable php7.4-fpm
sudo systemctl start php7.4-fpm
```



------





### **âš™ï¸ é…ç½® Nginx ä¸ PHP-FPM**







#### **ç¤ºä¾‹é…ç½®**

#### **/etc/nginx/sites-available/default**



```
server {
    listen 80;
    server_name localhost;

    root /var/www/html;
    index index.php index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }
}
```

> é‡å¯æœåŠ¡ï¼š

```
sudo systemctl reload nginx
```



------





### **ğŸ” æµ‹è¯• PHP ç¯å¢ƒ**



```
echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/info.php
```

è®¿é—®ä½ çš„å…¬ç½‘ IP åœ°å€ï¼ˆä¾‹ï¼šhttp://x.x.x.x/info.phpï¼‰éªŒè¯ã€‚



------





### **ğŸ“‰ å†…å­˜ä¼˜åŒ–å»ºè®®ï¼ˆéå¸¸å…³é”®ï¼‰**

- å…³é—­ä¸å¿…è¦æœåŠ¡ï¼š



```
sudo systemctl disable --now apache2
sudo systemctl disable --now snapd
```



- ç²¾ç®€ PHP æ¨¡å—ï¼ˆåªè£…ä½ éœ€è¦çš„ï¼‰
- è°ƒæ•´ php-fpm é…ç½® /etc/php/7.4/fpm/pool.d/www.confï¼Œä¾‹å¦‚ï¼š



```
pm = static
pm.max_children = 2
```



- Nginx é…ç½®å‡å°‘ workerï¼š



```
worker_processes 1;
events {
    worker_connections 128;
}
```



------





### **ğŸ“¦ è¿è¡Œç®€å• PHP é¡¹ç›®å»ºè®®**



- å°½é‡ä½¿ç”¨ **åŸç”Ÿ PHP æˆ–è½»é‡æ¡†æ¶ï¼ˆå¦‚ Slim / Lumenï¼‰**
- é™æ€èµ„æºäº¤ç»™ Nginx å¤„ç†
- ä¸è·‘å¤§å¹¶å‘æˆ–é˜Ÿåˆ—æœåŠ¡
- æ—¥å¿—åŠæ—¶æ¸…ç†ï¼Œé¿å…ç£ç›˜çˆ†æ»¡



 å¥½å˜ Aricï¼Œæˆ‘ä»¬æ¥æä¸ª**è¶…è½»é‡çº§ Slim æ¡†æ¶éƒ¨ç½²æ–¹æ¡ˆ**ï¼Œéå¸¸é€‚åˆä½ è¿™å°å°å†…å­˜çš„æœåŠ¡å™¨ã€‚Slim æ˜¯ PHP é‡Œçš„â€œå¾®æ¡†æ¶â€ï¼Œæ€§èƒ½ä¼˜ã€ä¾èµ–å°‘ï¼Œç®€ç›´ä¸º 0.5G å†…å­˜é‡èº«å®šåˆ¶ã€‚



------





## **âœ… å®‰è£… Slim 4 çš„æ­¥éª¤ï¼ˆPHP 7.4 ç¯å¢ƒï¼‰**





### **ğŸ§° å…ˆå†³æ¡ä»¶ï¼ˆç¡®ä¿ä»¥ä¸‹å·²è£…ï¼‰**



```
php -v        # å¿…é¡»æ˜¯ PHP 7.4+
composer -V   # æœ‰ Composerï¼ˆPHP åŒ…ç®¡ç†å™¨ï¼‰
```



### **â—å¦‚æœæ²¡è£… Composerï¼š**



```
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer
```



------





## **ğŸš€ å®‰è£… Slim é¡¹ç›®**





æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å®˜æ–¹æ¨èçš„ **slim/slim-skeleton** é¡¹ç›®æ¨¡æ¿ï¼š

```
# è¿›å…¥ç½‘ç«™ç›®å½•ï¼ˆä½ å¯ä»¥æ”¹æˆä½ è‡ªå·±çš„è·¯å¾„ï¼‰
cd /var/www

# åˆ›å»ºé¡¹ç›®ï¼ˆæ›¿æ¢ your-app-name ä¸ºä½ æƒ³ç”¨çš„åå­—ï¼‰
composer create-project slim/slim-skeleton your-app-name

# æƒé™å¤„ç†ï¼ˆå¯é€‰ï¼‰
sudo chown -R www-data:www-data your-app-name
```

é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
your-app-name/
â”œâ”€â”€ composer.json
â”œâ”€â”€ public/            ğŸ‘ˆ å¯¹å¤–æš´éœ²ç›®å½•
â”‚   â””â”€â”€ index.php
â”œâ”€â”€ src/               ğŸ‘ˆ æ§åˆ¶å™¨/é€»è¾‘
â”œâ”€â”€ templates/         ğŸ‘ˆ å¯é€‰è§†å›¾
â”œâ”€â”€ logs/              ğŸ‘ˆ æ—¥å¿—
â””â”€â”€ vendor/            ğŸ‘ˆ ä¾èµ–åº“
```



------





## **âš™ï¸ é…ç½® Nginx å¯¹ Slim çš„æ”¯æŒ**





ç¼–è¾‘ä½ çš„ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼ˆæˆ– /etc/nginx/sites-available/defaultï¼‰ï¼š

```
server {
    listen 80;
    server_name your-domain.com;  # æˆ–ä½¿ç”¨å…¬ç½‘IPæµ‹è¯•

    root /var/www/your-app-name/public;

    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }
}
```

ç„¶åé‡æ–°åŠ è½½ nginxï¼š

```
sudo systemctl reload nginx
```



------





## **ğŸ§ª æµ‹è¯•ä¸€ä¸‹**





æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ä½ çš„æœåŠ¡å™¨åœ°å€ï¼ˆä¾‹å¦‚ http://your-ip/ï¼‰ï¼Œå¦‚æœä½ çœ‹åˆ°è¿”å›ï¼š

```
Hello world!
```

å°±è¯´æ˜æˆåŠŸå•¦ï¼



------





## **ğŸ“¦ å¯é€‰åŠŸèƒ½æ‰©å±•ï¼ˆæ ¹æ®éœ€è¦ï¼‰**



| **åŠŸèƒ½**       | **æ‰©å±•åŒ…**                        |
| -------------- | --------------------------------- |
| æ¨¡æ¿æ¸²æŸ“       | slim/twig-view æˆ– slim/php-view   |
| è·¯ç”±ä¸­é—´ä»¶æ”¯æŒ | middlewares/fast-route, slim/psr7 |
| æ•°æ®åº“æ“ä½œ     | illuminate/database æˆ– pdo åŸç”Ÿ   |
| ç¯å¢ƒå˜é‡       | vlucas/phpdotenv                  |
| JSON API æ”¯æŒ  | Slim é»˜è®¤æ”¯æŒ JSON å“åº”           |



------





## **ğŸ å°è´´å£«**





- å¦‚æœåªè·‘ API é¡¹ç›®ï¼šä¸éœ€è¦æ¨¡æ¿ã€sessionã€csrfï¼Œé…ç½®æœ€ç®€
- å¦‚æœä½ æƒ³åšä¸€ä¸ªè½»é‡åšå®¢åå°ï¼Œä¹Ÿèƒ½åŸºäº Slim æ­å»º REST APIï¼Œå‰ç«¯ç”¨ Vue æˆ– Typecho å¯¹æ¥éƒ½è¡Œ



å¥½ï¼ŒAricï¼Œæˆ‘ä»¬æ¥ä¸€èµ·é…ç½®ä½ æ–°çš„åŸŸå slim.djibai.com æŒ‡å‘ä½  Slim é¡¹ç›®çš„ Nginx è™šæ‹Ÿä¸»æœºã€‚



------





## **ğŸ§­ æ­¥éª¤æ€»è§ˆï¼š**





1. è®¾ç½® DNS è§£æ
2. é…ç½® Nginx è™šæ‹Ÿä¸»æœº
3. å¯ç”¨ PHP å¤„ç†
4. é‡å¯ Nginx
5. æµ‹è¯•è®¿é—®



------





## **â‘  è®¾ç½® DNSï¼ˆåœ¨é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°ï¼‰**





å»é˜¿é‡Œäº‘ > åŸŸåè§£æ > djibai.com æ·»åŠ è§£æè®°å½•ï¼š

| **ç±»å‹** | **ä¸»æœºè®°å½•** | **è®°å½•å€¼**  | **å¤‡æ³¨**           |
| -------- | ------------ | ----------- | ------------------ |
| A        | slim         | ä½ çš„å…¬ç½‘ IP | æŒ‡å‘ä½ çš„æœåŠ¡å™¨åœ°å€ |

ç­‰å¾…ç”Ÿæ•ˆï¼Œé€šå¸¸å‡ åˆ†é’Ÿå†…ç”Ÿæ•ˆã€‚



------





## **â‘¡ åˆ›å»º Slim çš„ Nginx é…ç½®æ–‡ä»¶**





è·¯å¾„ï¼š/etc/nginx/sites-available/slim.djibai.com

```
server {
    listen 80;
    server_name slim.djibai.com;

    root /var/www/slim-app/public;  # ä¿®æ”¹ä¸ºä½ çš„ Slim é¡¹ç›®è·¯å¾„
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }
}
```



### **å»ºç«‹è½¯é“¾æ¥å¯ç”¨è¿™ä¸ªç«™ç‚¹ï¼š**



```
sudo ln -s /etc/nginx/sites-available/slim.djibai.com /etc/nginx/sites-enabled/
```



------





## **â‘¢ æƒé™ & ç›®å½•ç¡®è®¤**





ç¡®ä¿ä½ çš„ Slim é¡¹ç›®ç›®å½•å­˜åœ¨ä¸”æƒé™æ­£ç¡®ï¼š

```
sudo chown -R www-data:www-data /var/www/slim-app
```

ï¼ˆæˆ–è€…ä½ å®é™…ä½¿ç”¨çš„ç›®å½•ï¼‰



------





## **â‘£ æµ‹è¯•é…ç½®å¹¶é‡å¯ Nginx**



```
sudo nginx -t     # âœ… æ£€æŸ¥è¯­æ³•
sudo systemctl reload nginx
```



------





## **â‘¤ æµè§ˆå™¨è®¿é—®æµ‹è¯•**





åœ¨æµè§ˆå™¨è®¿é—®ï¼š

```
http://slim.djibai.com
```

å‡ºç° Slim è¿”å›çš„ Hello world! è¡¨ç¤ºæˆåŠŸ ğŸ‰



------





## **âœ… Bonusï¼šå»ºè®®åŠ ä¸Š HTTPS**





åç»­ä½ å¯ä»¥ç›´æ¥ç”¨ Letâ€™s Encrypt å…è´¹åŠ  SSLï¼š

```
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d slim.djibai.com
```

å®ƒä¼šè‡ªåŠ¨å¸®ä½ é…ç½® HTTPS å’Œ 301 è·³è½¬ã€‚



------



éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ SSL + é‡å®šå‘é…ç½®ã€æˆ–åç»­åŠ  JWT ç™»å½•æ¥å£ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æèµ· ğŸ˜



å½“ç„¶å¯ä»¥ï¼æˆ‘ä»¬æ¥å†™ä¸€ä¸ª ğŸ’¡ **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼Œå¸®ä½ ï¼š



> âœ… æ·»åŠ  Nginx è™šæ‹Ÿä¸»æœº

> âœ… åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆå« public/index.phpï¼‰

> âœ… å¯é€‰å¯ç”¨ HTTPS + è‡ªåŠ¨è·³è½¬ï¼ˆLetâ€™s Encryptï¼‰



------





## **ğŸ› ï¸ ä¸€é”®å»ºç«™è„šæœ¬**

## **add_slim_site.sh**



```
#!/bin/bash

# ç”¨æ³•: ./add_slim_site.sh domain.com [--ssl]

DOMAIN=$1
ENABLE_SSL=$2
WEBROOT="/var/www/$DOMAIN"
NGINX_CONF="/etc/nginx/sites-available/$DOMAIN"

if [[ -z "$DOMAIN" ]]; then
    echo "âŒ è¯·è¾“å…¥åŸŸåå‚æ•°ï¼Œå¦‚: ./add_slim_site.sh slim.djibai.com [--ssl]"
    exit 1
fi

echo "ğŸš€ å¼€å§‹ä¸º $DOMAIN åˆ›å»ºç«™ç‚¹..."

# 1. åˆ›å»ºç«™ç‚¹ç›®å½•
sudo mkdir -p $WEBROOT/public
sudo chown -R www-data:www-data $WEBROOT

# 2. ç”Ÿæˆ index.php
cat <<EOF | sudo tee $WEBROOT/public/index.php > /dev/null
<?php
echo "Hello from $DOMAIN!";
EOF

# 3. åˆ›å»º Nginx é…ç½®æ–‡ä»¶
cat <<EOF | sudo tee $NGINX_CONF > /dev/null
server {
    listen 80;
    server_name $DOMAIN;

    root $WEBROOT/public;
    index index.php index.html;

    location / {
        try_files \$uri \$uri/ /index.php?\$query_string;
    }

    location ~ \.php\$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }
}
EOF

# 4. å¯ç”¨ç«™ç‚¹
sudo ln -sf $NGINX_CONF /etc/nginx/sites-enabled/

# 5. é‡è½½ nginx
sudo nginx -t && sudo systemctl reload nginx

# 6. å¦‚æœå¼€å¯äº† --ssl
if [[ "$ENABLE_SSL" == "--ssl" ]]; then
    echo "ğŸ” å¼€å§‹ä¸º $DOMAIN é…ç½® HTTPS..."
    sudo apt install -y certbot python3-certbot-nginx
    sudo certbot --nginx -d $DOMAIN --non-interactive --agree-tos -m admin@$DOMAIN --redirect
fi

echo "âœ… ç«™ç‚¹ $DOMAIN å·²åˆ›å»ºæˆåŠŸï¼"
echo "ğŸ“ é¡¹ç›®è·¯å¾„: $WEBROOT"
[[ "$ENABLE_SSL" == "--ssl" ]] && echo "ğŸŒ è®¿é—®åœ°å€: https://$DOMAIN" || echo "ğŸŒ è®¿é—®åœ°å€: http://$DOMAIN"
```



------





## **ğŸ”§ ä½¿ç”¨æ–¹å¼**





1. ä¿å­˜ä¸ºè„šæœ¬æ–‡ä»¶ï¼š



```
nano add_slim_site.sh
chmod +x add_slim_site.sh
```



1. åˆ›å»ºç«™ç‚¹ï¼š





- ä¸åŠ  SSLï¼š



```
./add_slim_site.sh slim.djibai.com
```



- è‡ªåŠ¨åŠ  HTTPS + è·³è½¬ï¼š



```
./add_slim_site.sh slim.djibai.com --ssl
```



------





## **âœ… è„šæœ¬ç‰¹ç‚¹**





- è‡ªåŠ¨åˆ›å»ºç›®å½• /var/www/yourdomain
- è‡ªåŠ¨ç”Ÿæˆ index.php é¡µé¢
- è‡ªåŠ¨é…ç½® Nginx
- è‡ªåŠ¨ç­¾å‘ HTTPSï¼ˆå¯é€‰ï¼‰
- è‡ªåŠ¨é‡è½½æœåŠ¡



